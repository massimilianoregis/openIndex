
var $community=
	{
	services:function(){return macumba.services.community2;},
	config:
		{
		facebook:
			{
			app:""
			},
		apply:function(){}
		},
	init:function(name){},
	register:
		{
		mail:"aa@ekaros.it",
		psw:"test",
		psw2:"test",
		"try":function()
			{
			$(document).trigger("community.register.waiting");
			$.ajax({
					url:"community/register",
					data:JSON.parse(JSON.stringify(this)),
					complete: function()
						{
						$(document).trigger("community.register.done");
						},							
					success:function(data)			
						{						
						$(document).trigger("community.register");
						},
					dataType:"json"
					});
			/*
			$community.services().register.send(this,function(data)
					{					
					$.extend($community.user,data);					
					});*/
			}
		},
	login:
		{
		basic:
			{						
			mail:"pippo@ekaros.it",
			psw:"test",
			"try":function()
				{				
				$.ajax(
						{
						url:"community/login",
						data:JSON.parse(JSON.stringify(this)),
						success:function(data)						
							{		
							$.extend($community.user,data);
							$community.user.logged=true;
							$(document).trigger("community.logged");
							},
						error:function(data)
							{
							$(document).trigger("community.logerror");
							},
						dataType:"json"
						});
				/*
				$community.services().login.send(this,function(data)
					{					
					$.extend($community.user,data);
					});
				*/
				},
			remember:function(){},
			show:function(){}
			},
		qr:
			{
			"try":function(){},
			show:function(){}	
			},
		facebook:
			{
			"try":function()
				{
				var form = $('<FORM ACTION="/connect/facebook" METHOD="post"></FORM>');				
				form.submit()
				}
			},
		twitter:
			{			
			"try":function()
				{
				var form = $('<FORM ACTION="/connect/twitter" METHOD="post"></FORM>');				
				form.submit()				
				}
			},
		gplus:
			{
			"try":function(){}	
			}
		},
	user:
		{				
		password:
			{
			reset:function(){},
			send:function(){}
			},
		logout:function()
			{
			$.get("community/logout");
			this.logged=false;
			$(document).trigger("community.logout");
			},
		save:function()
			{
			var data =$.extend({},this);
			data.password=null;
			$.ajax(
					{
					url:"community/user/save",
					data:JSON.stringify(data),
					dataType:"json",					
					contentType: 'application/json',				    
					type:"POST"
					})
			},
		show:function(){}
		}
	};
$(function()
	{
	$.get("community/me",function(data)
			{		
			if(data==null) return;
			$.extend($community.user,data);
			$community.user.logged=true;
			$(document).trigger("community.logged");
			},"json");
	})